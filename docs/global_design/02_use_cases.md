# ユースケース定義書

## 👥 アクター定義（MVP）

| **アクター名** | **ID** | **説明** | **主な行動** |
|---------------|--------|----------|-------------|
| **未ログインユーザー** | Guest | ログインしていない一般利用者。ログインページのみ閲覧できる | Googleログイン |
| **ログインユーザー** | User | 自分のGoogleアカウントでログインしているユーザー | サブスク登録・編集・削除、支払い方法管理、合計金額確認 |

## ユースケース一覧

### 🔐 認証（AUTH）

- **UC-AUTH-Login**（Guest）
  - Googleアカウントでログインできる
  - 初回ログイン時は自動でアカウント登録される
- **UC-AUTH-Logout**（User）
  - ログアウトしてセッションを終了できる
- **UC-AUTH-Withdraw**（User）
  - 退会してアカウントと関連データをすべて削除できる
  - 削除対象：アカウント情報、サブスク、支払い方法

### 📝 サブスク管理（SUB）

- **UC-SUB-Create**（User）
  - 新規サブスクを手動で登録できる
  - 入力項目：サービス名（必須）、金額（必須）、請求サイクル（必須）、基準日（必須）、支払い方法（任意）、メモ（任意）
  - 支払い方法は既存から選択、または**インラインで新規追加**可能
- **UC-SUB-Edit**（User）
  - 自分のサブスクを編集できる
  - 全項目を変更可能
- **UC-SUB-Delete**（User）
  - 自分のサブスクを削除できる（物理削除）
  - 確認ダイアログを表示
- **UC-SUB-List**（User）
  - 登録済みサブスクをカード形式で一覧表示できる
  - 各サブスクの次回請求日は基準日と請求サイクルから自動計算して表示
  - 月額換算・年額換算の合計金額を同時に表示
  - ※MVPではソート機能なし

### 💳 支払い方法管理（PAY）

- **UC-PAY-Create**（User）
  - 任意の名前で支払い方法を登録できる（例：楽天カード、PayPal）
  - 登録方法：設定画面から、またはサブスク登録時にインライン追加
- **UC-PAY-Edit**（User）
  - 登録済みの支払い方法名を変更できる
- **UC-PAY-Delete**（User）
  - 支払い方法を削除できる
  - **制約：サブスクで使用中の支払い方法は削除不可**
- **UC-PAY-List**（User）
  - 登録済みの支払い方法を一覧表示できる

## 🔒 権限の前提（MVP）

| 操作 | 権限 |
|------|------|
| **閲覧** | 自分のデータのみ閲覧可能（他ユーザーのデータは見えない） |
| **登録/編集/削除** | 自分のデータのみ操作可能 |
| **支払い方法削除** | 使用中でない場合のみ削除可能 |

※ SubsQは完全にプライベートなデータ管理アプリのため、他ユーザーとのデータ共有機能はなし

## 💰 料金計算仕様

| 項目 | 仕様 |
|------|------|
| **月額換算** | 年額サブスクは ÷ 12 で計算 |
| **年額換算** | 月額サブスクは × 12 で計算 |
| **小数点処理** | 円未満切り捨て（floor） |
| **表示タイミング** | サブスク一覧画面で常時表示 |

## 📅 次回請求日の計算仕様

| 項目 | 仕様 |
|------|------|
| **保存データ** | 基準日（初回支払日または任意の請求日） |
| **計算方法** | 基準日から請求サイクル（月額/年額）を加算し、今日以降の最も近い日付を算出 |
| **計算タイミング** | 一覧表示時にリアルタイム計算（DBへの更新は行わない） |

**計算例：**
- 基準日: 2024/03/15、請求サイクル: 月額、今日: 2025/01/20 の場合
  - → 次回請求日: 2025/02/15